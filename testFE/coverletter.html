<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title id="title">Generated Cover Letter</title>
    <link rel="stylesheet" href="quickpage.css">
</head>

<body>
    <div class="container">
        
        <section class="summary">
            <h3 style="text-align: center;">Cover Letter</h3>
            <p id="coverletter">
               
            </p>
        </section>
         
            

           
           
    </div>
    <div id="sections"></div>
    <script src="./url.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const params = new URLSearchParams(window.location.search);
            const clId = params.get('clId'); 
            const apiUrl = config.baseUrl + `/api/resume/${clId}`

            fetch(apiUrl, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: "Bearer " + localStorage.getItem("token"),
                }
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Data obtained: ', data)
                    populateResume(JSON.parse(data.coverletter)); 
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    alert('Failed to load resume data.');
                });
        });

        let uid = localStorage.getItem("uid");
        if (uid) {
            const apiUrl = config.baseUrl + `/api/userDetails/${uid}`
            fetch(apiUrl, {
                headers: {
                    Authorization:
                        "Bearer " + localStorage.getItem("token"),
                },
            })
                .then((response) => response.json())
                .then((data) => {
                    console.log("Received data: ", data[0]);
                })
                .catch((error) =>
                    console.error("Error fetching user data:", error)
                );
        }





        function populateResume(generatedCV) {
            console.log('Cover Letter: ', generatedCV)
            let formattedText = generatedCV.replace(/\n/g,'<br>')
            document.getElementById('coverletter').innerHTML = formattedText;
                
        }
    </script>
</body>

</html>