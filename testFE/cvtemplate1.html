<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title id="title">Generated Resume</title>
    <link rel="stylesheet" href="quickpage.css">
</head>

<body>
    <div class="container">
        <header>
            <h1 id="name">JONATHAN WRIGHT</h1>
            <h2 id="job-role">Lead Business Analyst</h2>
            <p class="contact-info">
                <a id="phone-number">+1-921-389-0182</a> | <a id="email">name@gmail.com</a> |
                <a id="lives-in">
                    Dallas, TX
                </a>
            </p>
        </header>
        <section class="summary">
            <h3 style="text-align: center;">Summary</h3>
            <p id="about">
               
            </p>
        </section>
        <section class="skills">
            <h3 style="text-align: center;">Skills</h3>
            <p><i id="skills"></i></p>
        </section>
        <section class="experience">
            <h3 style="text-align: center;">Experience</h3>
            <div id="experience">
                

            </div>
            
            <section class="education">
                <h3 style="text-align: center;">Education</h3>
                <div id="education">
                    <!-- <div class="degree">
                        <div class="degree-details">
                            <h4 id="institution">University of Wisconsin</h4>
                            <p id="degree">M.Sc. in Finance</p>
                        </div>
                        <div id="degree-date">Wisconsin<br>2012 - 2013</div>
                    </div> -->

                </div>
                
            </section>
            <section class="courses">
                <h3 style="text-align: center;">Courses & Certificates</h3>
                <div id="certifications">
                   
                </div>
                
            </section>

            <section class="courses">
                <h3 style="text-align: center;">Projects</h3>
                <div id="projects">
                    
                </div>
                
            </section>
           
    </div>
    <div id="sections"></div>
    <script src="./url.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const params = new URLSearchParams(window.location.search);
            const cvId = params.get('cvId'); 
            const apiUrl = config.baseUrl + `/api/resume/${cvId}`

            fetch(apiUrl, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: "Bearer " + localStorage.getItem("token"),
                }
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Data obtained: ', data)
                    populateResume(JSON.parse(data.generatedCV)); 
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    alert('Failed to load resume data.');
                });
        });

        let uid = localStorage.getItem("uid");
        if (uid) {
            const apiUrl = config.baseUrl + `/api/userDetails/${uid}`
            fetch(apiUrl, {
                headers: {
                    Authorization:
                        "Bearer " + localStorage.getItem("token"),
                },
            })
                .then((response) => response.json())
                .then((data) => {
                    console.log("Received data: ", data[0]);
                    if (data[0]) {
                        document.getElementById("phone-number").textContent = data[0].contactDetails.phone
                        document.getElementById("lives-in").textContent = data[0].contactDetails.address
                    }
                })
                .catch((error) =>
                    console.error("Error fetching user data:", error)
                );
        }





        function populateResume(generatedCV) {
            document.getElementById('name').textContent = generatedCV.name;

            document.getElementById('email').textContent = generatedCV.email;

            document.getElementById('email').href = 'mailto:' + generatedCV.email;
            document.getElementById('about').textContent = generatedCV.about;
            document.getElementById('job-role').textContent = generatedCV.currentJobTitle;
            const formattedSkills = generatedCV.skills.map(skill => skill).join(', ');
            console.log('formattedSkills:', formattedSkills)
            document.getElementById('skills').textContent = formattedSkills

            const edexp = generatedCV['education']
            let j = 0
            edexp.map(ed => {
                console.log('Education: ', ed)
                j=j+1
                let educationId = document.getElementById('education')
                let superMainJobDiv = document.createElement('div')
                const superMainAtt = document.createAttribute('class')
                superMainAtt.value = "degree"
                superMainJobDiv.setAttributeNode(superMainAtt)

                let mainDiv = document.createElement('div');
                let att = document.createAttribute("class")
                att.value="degree-details"
                mainDiv.setAttributeNode(att)

                let institutionHeading = document.createElement('h4')
                institutionHeading.innerHTML = ed.institution
                mainDiv.appendChild(institutionHeading)

                let degreeDetails = document.createElement('p')
                degreeDetails.innerHTML = ed.degree + " in " + ed.specialization
                mainDiv.appendChild(degreeDetails)

                let degreeDate = document.createElement('div')
                degreeDate.innerHTML = ed.year

                superMainJobDiv.appendChild(mainDiv)
                superMainJobDiv.appendChild(degreeDate) 
                educationId.appendChild(superMainJobDiv)               

            })


            // document.getElementById('institution').textContent = generatedCV.education.institution
            // document.getElementById('degree').textContent = generatedCV.education.degree
            // document.getElementById('degree-date').innerHTML = `<br>${generatedCV.education.year}`

            const profexp = generatedCV['professionalExperience']
            console.log('profexp: ', profexp)
            let i =0

            profexp.map(exp => {
                console.log('Prof: ', exp)
                i=i+1
                let experienceId = document.getElementById('experience')
                let superMainJobDiv = document.createElement('div')
                const superMainAtt = document.createAttribute('class')
                superMainAtt.value = "job"
                superMainJobDiv.setAttributeNode(superMainAtt)



                const mainDiv = document.createElement('div');
                const att = document.createAttribute("class")
                att.value="job-details"
                mainDiv.setAttributeNode(att)
                const companyNameId = document.createElement("h4")
                const compAttr = document.createAttribute("id")
                compAttr.value="companyName-"+i
                companyNameId.setAttributeNode(compAttr)
                companyNameId.innerHTML = exp.company
                mainDiv.appendChild(companyNameId)


                const positionId = document.createElement('p')
                const positionIdAttr = document.createAttribute("id")
                positionIdAttr.value="job-role-"+i
                positionId.setAttributeNode(positionIdAttr)
                positionId.innerHTML = exp.position
                mainDiv.appendChild(positionId)

                const expResponUlId = document.createElement('ul')
                exp.responsibilities.map(respon => {
                    let respoLi = document.createElement('li')
                    respoLi.innerHTML=respon
                    expResponUlId.appendChild(respoLi)
                })
                mainDiv.appendChild(expResponUlId)

                superMainJobDiv.appendChild(mainDiv)
                
                let jobDateDiv = document.createElement('div')
                jobDateDiv.innerHTML = exp.duration + ' | ' + exp.location

                superMainJobDiv.appendChild(jobDateDiv)
                experienceId.appendChild(superMainJobDiv);
            });

            let certiList = generatedCV['certifications']
            const certificationDiv = document.getElementById('certifications')
            certiList.map(c => {
                let certiData = document.createElement('p')
                certiData.innerHTML = c.name + " - " + c.issuer
                certificationDiv.appendChild(certiData)
            })

            let projectList = generatedCV['projects']
            console.log('projectList: ',projectList)
            const projectDiv = document.getElementById('projects')
            projectList.map(p => {
                
                let mainProjectDiv = document.createElement('div')
                let mainProjectDivAttr = document.createAttribute('class')
                mainProjectDivAttr.value = "degree-details"
                mainProjectDiv.setAttributeNode(mainProjectDivAttr)
                let projectNameDiv = document.createElement('h4')
                projectNameDiv.innerHTML = p.title
                mainProjectDiv.appendChild(projectNameDiv)
                let projectDescriptionDiv = document.createElement('i')
                projectDescriptionDiv.innerHTML = p.description
                mainProjectDiv.appendChild(projectDescriptionDiv)
                let projectDetailsDiv = document.createElement('p')
                projectDetailsDiv.innerHTML = p.details
                mainProjectDiv.appendChild(projectDetailsDiv)
                projectDiv.appendChild(mainProjectDiv)
                // projectDiv.appendChild(projectNameDiv)
                // projectDiv.appendChild(projectDetailsDiv)
            })

        }
    </script>
</body>

</html>